<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>관리자 페이지</title>

<style>
body{font-family:Arial;padding:30px;background:#f5f5f5;}
h1{margin-bottom:20px;}
h2{margin-top:40px;}

input{
  width:100%;
  height:36px;
  margin-bottom:8px;
  padding:0 8px;
  box-sizing:border-box;
}

button{
  height:38px;
  padding:0 15px;
  border:none;
  border-radius:6px;
  background:#87CEEB;
  color:#fff;
  cursor:pointer;
}

button:hover{background:#6bbfe0;}

.section{margin-bottom:30px;}

.save-btn{
  width:240px;
  height:45px;
  font-size:16px;
  margin:40px auto;
  display:block;
}
</style>
</head>

<body>

<h1>관리자 페이지</h1>

<!-- ===== 배너 ===== -->
<div class="section">
<h2>상단 배너</h2>
<input id="bannerImg" placeholder="배너 이미지 URL">
<input id="bannerLink" placeholder="배너 클릭 링크">
</div>

<!-- ===== 소유자 & SNS ===== -->
<div class="section">
<h2>소유자 & SNS 관리</h2>
<input id="ownerName" placeholder="소유자 이름">
<input id="instagram" placeholder="Instagram 링크">
<input id="youtube" placeholder="YouTube 링크">
<input id="facebook" placeholder="Facebook 링크">
<input id="twitter" placeholder="X(트위터) 링크">
</div>

<button class="save-btn" onclick="saveSettings()">저장하기</button>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="supabase.js"></script>

<script>

/* ===== 데이터 불러오기 ===== */

async function loadData(){

  const { data, error } = await supabaseClient
    .from("site_settings")
    .select("*")
    .eq("id",1)
    .single();

  if(error){
    console.error("불러오기 오류:",error);
    return;
  }

  if(data){
    bannerImg.value=data.banner_img||"";
    bannerLink.value=data.banner_link||"";
    ownerName.value=data.owner_name||"";
    instagram.value=data.instagram||"";
    youtube.value=data.youtube||"";
    facebook.value=data.facebook||"";
    twitter.value=data.twitter||"";
  }
}

/* ===== 저장 ===== */

async function saveSettings(){

  const payload={
    id:1,
    banner_img:bannerImg.value.trim(),
    banner_link:bannerLink.value.trim(),
    owner_name:ownerName.value.trim(),
    instagram:instagram.value.trim(),
    youtube:youtube.value.trim(),
    facebook:facebook.value.trim(),
    twitter:twitter.value.trim()
  };

  /* 먼저 update 시도 */
  const { data, error } = await supabaseClient
    .from("site_settings")
    .update(payload)
    .eq("id",1);

  if(error){
    console.error("update 실패:",error);

    /* update 실패하면 insert */
    const { error: insertError } = await supabaseClient
      .from("site_settings")
      .insert([payload]);

    if(insertError){
      console.error("insert 실패:",insertError);
      alert("저장 실패 ❌ 콘솔 확인");
      return;
    }
  }

  alert("저장 완료 ✅");
}

loadData();

</script>

</body>
</html>