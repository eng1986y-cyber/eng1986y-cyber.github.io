<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>정보공유 플랫폼</title>

<style>
body{margin:0;padding:20px;font-family:Arial;background:#f5f5f5;}
.container{max-width:1200px;margin:0 auto;}

.top-banner{
  width:100%;
  height:120px;
  margin:20px 0 30px;
  border-radius:14px;
  overflow:hidden;
  border:2px solid #87CEEB;
}
.top-banner img{
  width:100%;
  height:100%;
  object-fit:cover;
}

.grid{
  display:grid;
  grid-template-columns:repeat(6,1fr);
  gap:10px;
  margin-bottom:40px;
}

.text-ad{
  background:#fff;
  border:1px solid #ccc;
  padding:12px;
  text-align:center;
  border-radius:8px;
  text-decoration:none;
  color:#222;
}

.square-ad{
  aspect-ratio:1/1;
  border-radius:12px;
  overflow:hidden;
  border:1px solid #ddd;
}
.square-ad img{
  width:100%;
  height:100%;
  object-fit:cover;
  cursor:pointer;
}

/* 팝업 */
.popup{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.85);
  justify-content:center;
  align-items:center;
  z-index:9999;
}
.popup img{
  max-width:90%;
  max-height:90%;
  border-radius:16px;
}
.close-btn{
  position:absolute;
  top:30px;
  right:40px;
  font-size:40px;
  color:#fff;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="container">

<div class="top-banner" id="topBanner"></div>

<div class="grid" id="textAds"></div>

<div class="grid" id="bottomImageAds"></div>

</div>

<div id="imgPopup" class="popup" onclick="closePopup()">
  <span class="close-btn">&times;</span>
  <img id="popupImage">
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="supabase.js"></script>

<script>

function openPopup(src){
  document.getElementById("popupImage").src=src;
  document.getElementById("imgPopup").style.display="flex";
}

function closePopup(){
  document.getElementById("imgPopup").style.display="none";
}

async function loadSite(){

  const bannerBox=document.getElementById("topBanner");
  const textBox=document.getElementById("textAds");
  const bottomBox=document.getElementById("bottomImageAds");

  bannerBox.innerHTML="";
  textBox.innerHTML="";
  bottomBox.innerHTML="";

  /* 광고 불러오기 */
  const { data: ads } = await supabaseClient
    .from("ads")
    .select("*")
    .order("id",{ascending:true});

  if(ads){
    ads.forEach(ad=>{

      if(ad.type==="text"){
        const a=document.createElement("a");
        a.className="text-ad";
        a.href=ad.link_url || "#";
        a.target="_blank";
        a.innerText=ad.title || "텍스트광고";
        textBox.appendChild(a);
      }

      if(ad.type==="square"){
        const wrap=document.createElement("div");
        wrap.className="square-ad";

        if(ad.link_url){
          wrap.innerHTML=`
            <a href="${ad.link_url}" target="_blank">
              <img src="${ad.image_url}">
            </a>`;
        }else{
          wrap.innerHTML=`
            <img src="${ad.image_url}"
                 onclick="openPopup('${ad.popup_url || ad.image_url}')">`;
        }

        bottomBox.appendChild(wrap);
      }

    });
  }

  /* 배너 불러오기 */
  const { data: settings } = await supabaseClient
    .from("site_settings")
    .select("*")
    .limit(1);

  if(settings && settings.length>0){
    const s=settings[0];

    if(s.banner_img){
      if(s.banner_link){
        bannerBox.innerHTML=`
          <a href="${s.banner_link}" target="_blank">
            <img src="${s.banner_img}">
          </a>`;
      }else{
        bannerBox.innerHTML=`<img src="${s.banner_img}">`;
      }
    }
  }
}

loadSite();

</script>
</body>
</html>